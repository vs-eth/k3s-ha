# K3s server configuration file
# Generated by Ansible

# Token for authentication
token: "{{ k3s_token }}"

{% if k3s_cluster_init | bool %}
# Initialize cluster with embedded etcd
cluster-init: true
{% elif k3s_server_url %}
# Join existing cluster
server: "{{ k3s_server_url }}"
{% endif %}

{% if k3s_embedded_etcd %}
# Use embedded etcd for HA
cluster-init: {{ k3s_cluster_init | lower }}
{% endif %}

{% if k3s_datastore_endpoint %}
# External datastore endpoint
datastore-endpoint: "{{ k3s_datastore_endpoint }}"
{% endif %}

# Network configuration
cluster-cidr: "{{ k3s_cluster_cidr }}"
service-cidr: "{{ k3s_service_cidr }}"
cluster-domain: "{{ k3s_cluster_domain }}"

# Data directory
data-dir: "{{ k3s_data_dir }}"

# Kubeconfig settings
write-kubeconfig-mode: "{{ k3s_write_kubeconfig_mode }}"

{% if k3s_tls_san | length > 0 %}
# TLS SAN entries
tls-san:
{% for san in k3s_tls_san %}
  - "{{ san }}"
{% endfor %}
{% endif %}

{% if k3s_node_labels | length > 0 %}
# Node labels
node-label:
{% for label in k3s_node_labels %}
  - "{{ label }}"
{% endfor %}
{% endif %}

{% if k3s_node_taints | length > 0 %}
# Node taints
node-taint:
{% for taint in k3s_node_taints %}
  - "{{ taint }}"
{% endfor %}
{% endif %}

# Disable components
disable:
{% if k3s_disable_components | length > 0 %}
{% for component in k3s_disable_components %}
  - "{{ component }}"
{% endfor %}
{% else %}
  - local-storage
  - metrics-server
{% endif %}